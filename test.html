<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"> 
<title>DAq Dashboard</title>
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
</head>
<body>

<style>
body {
	font-family: Arial;
}
svg {
	border: 1px solid #dddddd;
}
</style>

<h1>DAq Dashboard</h1>
<div class="data"></div>

<script type="text/javascript">
var data;
var dataPoints = [
	"engineLoad",
	"coolantTemp",
	"rpm",
	"speed",
	"intakeTemp",
	"maf",
	"throttlePos",
	//"xG",
	//"yG",
	//"zG",
	"gpsSpeed",
	"gpsLat",
	"gpsLon",
	"gpsAlt",
	"gpsClimb"
];
var timeFormat = d3.time.format("%H:%M:%S.%L");
var width = 1000;
var height = 300;
var MARGINS = {
	top: 20,
	right: 20,
	bottom: 20,
	left: 100
};

d3.csv("201606051346.csv")
	.row(function(d) {return {
		time: timeFormat.parse(d.time.replace(/(\.[0-9]{3})[0-9]*/, "$1")),
		engineLoad: +d.engineLoad,
		coolantTemp: +d.coolantTemp,
		rpm: +d.rpm,
		speed: +d.speed,
		intakeTemp: +d.intakeTemp,
		maf: +d.maf,
		throttlePos: +d.throttlePos,
		xG: +d.xG,
		yG: +d.yG,
		zG: +d.zG,
		gpsSpeed: +d.gpsSpeed,
		gpsLat: +d.gpsLat,
		gpsLon: +d.gpsLon,
		gpsAlt: +d.gpsAlt,
		gpsClimb: +d.gpsClimb};
	})
	.get(function(error, rows) {
			data = rows;
		  processData();
	});

function processData() {
	for (x in dataPoints) {
		var svg = d3.select("body").append("svg")
			.attr("width", width + MARGINS.left + MARGINS.right)
			.attr("height", height + MARGINS.top + MARGINS.bottom);

		// X-axis
		var xScale = d3.time.scale().domain([data[0].time, data[data.length-1].time]).range([MARGINS.left, width + MARGINS.left - MARGINS.right]);
		xScale.tickFormat(d3.time.format("%H:%M:%S.%L"));
		var xAxis = d3.svg.axis().scale(xScale).ticks(10);
		svg.append("text")
			.attr("x", width / 2)
			.attr("y", height + MARGINS.bottom)
			.style("text-anchor", "middle")
			.text("Time");
		svg.append("svg:g")
			.attr('stroke-width', 1)
			.attr('transform', 'translate(0,' + (height - MARGINS.bottom) + ')').call(xAxis);

		// Y-axis
		var yScale = generateYAxis(dataPoints[x]);
		var yAxis = d3.svg.axis().scale(yScale).orient("left");
		svg.append("text")
			.attr("transform", "rotate(-90)")
			.attr("x", 0 - (height / 2))
			.attr("dy", "1em")
			.style("text-anchor", "middle")
			.text(dataPoints[x]);
		svg.append("svg:g")
			.attr('transform', 'translate(' + MARGINS.left + ',0)')
			.call(yAxis);

		// Line
		var lineFunc = d3.svg.line()
			.x(function(d) {
				return xScale(d["time"]);
			})
			.y(function(d) {
				return yScale(d[dataPoints[x]]);
			});
		svg.append('svg:path')
			.attr('d', lineFunc(data))
			.attr('stroke', 'blue')
			.attr('stroke-width', 2)
			.attr('fill', 'none');
	}

	// GPS graph
	var gps = d3.select("body").append("svg")
		.attr("width", 500)
		.attr("height", 500);
	var xScale = d3.scale.linear().domain([-1,1]).range([0,500]);
	var xAxis = d3.svg.axis().scale(xScale).ticks(10);
	gps.append("svg:g")
		.attr('stroke-width', 1)
		.attr('transform', 'translate(0,250)')
		.call(xAxis);
	var yScale = d3.scale.linear().domain([-1,1]).range([0,500]);
	var yAxis = d3.svg.axis().scale(yScale).orient("left");
	gps.append("svg:g")
		.attr('transform', 'translate(250,0)')
		.call(yAxis);
	var lineFunc = d3.svg.line()
		.x(function(d) {
			return xScale(d["xG"]);
			})
		.y(function(d) {
			return yScale(d["yG"]);
		});
	gps.append("svg:path")
		.attr("d", lineFunc(data))
		.attr("stroke", "blue")
		.attr("stroke-width", 1)
		.attr("fill", "none");
}

function generateYAxis(dataPoint) {
	var maxDomain = d3.max(data, function(d) { return d[dataPoint]});
	var minDomain = d3.min(data, function(d) { return d[dataPoint]});
	return d3.scale.linear().domain([minDomain, maxDomain]).range([height - MARGINS.top, MARGINS.bottom]);
}
</script>

</body>
</html>
